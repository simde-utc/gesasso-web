{% extends 'base.html' %}
{% load gingertime %}
{% load groups %}

{% block page_name %}Clés d'API Ginger{% endblock %}

{% block content %}

<h2 class="header amber-text">Ginger</h2>
<div class="row">
  <h5 class="header col s12 light">Gestion des clés d'API</h5>
</div>
<div class="row">
<form action="#">
  <div class="input-field">
    <div class="row">
      <div class="col s9">
        <input type="text" id="autocomplete-input" class="autocomplete">
        <label for="autocomplete-input">Rechercher une clé par nom ou par description</label>
      </div>
      <div class="btn waves-effect waves-light amber right">
        <span>Rechercher</span>
      </div>
    </div>
  </div>
</form>
</div>
<ul class="collection">
  {% for key in keys %}
    <li class="collection-item expandable avatar">
      <i class="material-icons circle grey lighten-1">face</i>
      <span class="title">{{ key.login }}</span>
      <p class="grey-text text-lighten-1">{{ key.key }}<br/>
      {{ key.description }}
      </p>
      <a href="#!" class="secondary-content"><i class="material-icons amber-text">more_vert</i></a>
      <div>
        <p>Id: {{ key.id }}</p>
        <p>Création {{ key.createdAt|ginger_date_to_human }}, mis à jour {{ key.updatedAt|ginger_date_to_human }}</p>
        {% if key.permissions %}
        <p>Permissions:</p>
        {% for permission in key.permissions %}
          <div class="chip">
            {{ permission }}
          </div>
        {% endfor %}
        {% else %}
        <p>Pas de permission particulière : accès aux informations des étudiants et des cotisations en lecture uniquement.</p>
        {% endif %}
        <a href="{% url 'ginger:delete_key' key.id %}" class="btn waves-effect waves-light amber right confirm"><span>Supprimer</span> <i class="material-icons right">delete</i></a>
        
      </div>
    </li>
  {% endfor %}
</ul>

{% if request.user|has_group_in:"simde" %} 
<div class="fixed-action-btn">
  <a class="btn-floating btn-large amber btn-new">
    <i class="large material-icons">add</i>
  </a>
</div>
{% endif %}

{% endblock %}


{% block form-title %}Ajouter une clé Ginger{% endblock %}

{% block form %}
{% if request.user|has_group_in:"simde" %} 

<form class="col s12" action="{% url 'ginger:api' %}" method="post">
  {% csrf_token %}
  {% autoescape off %}
    {{ form.as_materialize }}
  {% endautoescape %}

  <button class="btn waves-effect waves-light amber right" type="submit">Ajouter
    <i class="material-icons right">send</i>
  </button>
</form>

<div class="row">
  <!-- <div class="input-field col s12"> -->
  <div class="col s12">
    <label>Sélectionner une asso</label>
    <select style="display: block;" name="login">
      <!-- <option value="" disabled selected>Asso</option> -->
      {% for asso in assos %}
        <option value="{{ asso.login }}">{{ asso.name }}</option>
      {% endfor %}
    </select>
    <!-- <label>Sélectionner une asso</label> -->
  </div>
</div>
{% endif %}
{% endblock %}